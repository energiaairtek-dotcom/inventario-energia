<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Airtek - Gestión de Consumibles Energía</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
            letter-spacing: -0.01em;
        }
        
        .shadow-premium {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.05), 0 10px 10px -5px rgba(0, 0, 0, 0.02);
        }

        .tab-content {
            animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .pulse-online {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .4; }
        }

        @media print {
            .no-print { display: none !important; }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, updateDoc, deleteDoc, collection, query, onSnapshot, addDoc, serverTimestamp, writeBatch } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const myConfig = {
            apiKey: "AIzaSyDwaK4Z26RfqDwNvwdMqri08oEjwG9qymc",
            authDomain: "almacen-airtek.firebaseapp.com",
            projectId: "almacen-airtek",
            storageBucket: "almacen-airtek.firebasestorage.app",
            messagingSenderId: "934058211778",
            appId: "1:934058211778:web:6cc9d820c41fa90aa5fe5b"
        };

        window.__firebase_config_manual = JSON.stringify(myConfig);

        window.FirebaseSDK = {
            initializeApp, getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken,
            getFirestore, doc, setDoc, updateDoc, deleteDoc, collection, 
            query, onSnapshot, addDoc, serverTimestamp, writeBatch
        };
        window.dispatchEvent(new Event('firebase-ready'));
    </script>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        const EnergyLogo = ({ className = "h-8 w-8" }) => (
            <svg viewBox="0 0 24 24" fill="none" className={className} xmlns="http://www.w3.org/2000/svg">
                <path d="M13 2L3 14H12L11 22L21 10H12L13 2Z" fill="currentColor" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
            </svg>
        );

        const App = () => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [isCloud, setIsCloud] = useState(false);
            const [inventory, setInventory] = useState([]);
            const [history, setHistory] = useState([]);
            const [activeTab, setActiveTab] = useState('inventory');
            
            // Search and Multi-item state
            const [exitHeader, setExitHeader] = useState({ tech: '', monitor: '', description: '' });
            const [currentSearch, setCurrentSearch] = useState('');
            const [showSearchList, setShowSearchList] = useState(false);
            const [selectedItems, setSelectedItems] = useState([]); 

            // Admin state
            const [newItem, setNewItem] = useState({ id: '', name: '', stock: '', min: 5, unit: 'pza' });
            const [editingItem, setEditingItem] = useState(null);

            const dbRef = useRef(null);
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'airtek-energia-v1';

            const monitoresAlmacen = ["LUIS RAMOS", "GUSTAVO RINCÓN", "DIEGO CHACÍN"];

            useEffect(() => {
                const init = async () => {
                    if (!window.FirebaseSDK) return;
                    const { initializeApp, getAuth, getFirestore, signInAnonymously, onAuthStateChanged, signInWithCustomToken } = window.FirebaseSDK;
                    
                    try {
                        const configStr = typeof __firebase_config !== 'undefined' ? __firebase_config : window.__firebase_config_manual;
                        const config = JSON.parse(configStr);
                        const app = initializeApp(config);
                        dbRef.current = getFirestore(app);
                        const auth = getAuth(app);

                        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                            await signInWithCustomToken(auth, __initial_auth_token);
                        } else {
                            await signInAnonymously(auth);
                        }

                        const unsubscribe = onAuthStateChanged(auth, (u) => {
                            if (u) { setUser(u); setIsCloud(true); }
                            setLoading(false);
                        });
                        return unsubscribe;
                    } catch (e) { setLoading(false); }
                };
                window.addEventListener('firebase-ready', init);
                if (window.FirebaseSDK) init();
                return () => window.removeEventListener('firebase-ready', init);
            }, []);

            useEffect(() => {
                if (!isCloud || !user || !dbRef.current) return;
                const { collection, onSnapshot } = window.FirebaseSDK;
                const invPath = collection(dbRef.current, 'artifacts', appId, 'public', 'data', 'inventory');
                const histPath = collection(dbRef.current, 'artifacts', appId, 'public', 'data', 'history');

                const unsubInv = onSnapshot(invPath, (snap) => {
                    setInventory(snap.docs.map(d => ({ ...d.data(), docId: d.id })));
                });

                const unsubHist = onSnapshot(histPath, (snap) => {
                    const logs = snap.docs.map(d => ({ ...d.data(), id: d.id }));
                    setHistory(logs.sort((a,b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0)));
                });

                return () => { unsubInv(); unsubHist(); };
            }, [isCloud, user, appId]);

            const exportInventoryPDF = () => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                doc.setFontSize(18);
                doc.text("AIRTEK ENERGÍA - REPORTE DE INVENTARIO", 14, 20);
                doc.setFontSize(10);
                doc.text(`Generado: ${new Date().toLocaleString()}`, 14, 28);

                const tableData = inventory.map(i => [i.id, i.name, i.stock, i.unit, i.stock <= i.min ? 'CRÍTICO' : 'OK']);
                
                doc.autoTable({
                    startY: 35,
                    head: [['Código', 'Artículo', 'Stock', 'Unidad', 'Estado']],
                    body: tableData,
                    headStyles: { fillColor: [37, 99, 235] },
                });

                doc.save(`Inventario_Airtek_${new Date().toISOString().split('T')[0]}.pdf`);
            };

            const exportHistoryPDF = () => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                doc.setFontSize(18);
                doc.text("AIRTEK ENERGÍA - BITÁCORA DE MOVIMIENTOS", 14, 20);
                doc.setFontSize(10);
                doc.text(`Generado: ${new Date().toLocaleString()}`, 14, 28);

                const tableData = history.map(h => [h.dateStr, h.item, h.qty, h.tech, h.monitor]);
                
                doc.autoTable({
                    startY: 35,
                    head: [['Fecha', 'Artículo', 'Cant', 'Beneficiario', 'Monitor']],
                    body: tableData,
                    headStyles: { fillColor: [37, 99, 235] },
                });

                doc.save(`Bitacora_Airtek_${new Date().toISOString().split('T')[0]}.pdf`);
            };

            const filteredInventory = useMemo(() => {
                if (!currentSearch) return [];
                const search = currentSearch.toLowerCase();
                return inventory.filter(i => 
                    i.name.toLowerCase().includes(search) || 
                    i.id.toLowerCase().includes(search)
                ).slice(0, 5);
            }, [currentSearch, inventory]);

            const addItemToExitList = (item) => {
                if (selectedItems.find(si => si.id === item.id)) return;
                setSelectedItems([...selectedItems, { ...item, qty: 1 }]);
                setCurrentSearch('');
                setShowSearchList(false);
            };

            const removeSelected = (id) => {
                setSelectedItems(selectedItems.filter(i => i.id !== id));
            };

            const updateSelectedQty = (id, newQty) => {
                setSelectedItems(selectedItems.map(i => i.id === id ? { ...i, qty: Math.max(1, Number(newQty)) } : i));
            };

            const handleBulkExit = async (e) => {
                e.preventDefault();
                if (selectedItems.length === 0 || !exitHeader.monitor) return;

                const { doc, writeBatch, collection, serverTimestamp } = window.FirebaseSDK;
                const batch = writeBatch(dbRef.current);
                const dateStr = new Date().toLocaleString();

                try {
                    selectedItems.forEach(item => {
                        const invDocRef = doc(dbRef.current, 'artifacts', appId, 'public', 'data', 'inventory', item.docId);
                        batch.update(invDocRef, { stock: item.stock - item.qty });

                        const histColRef = doc(collection(dbRef.current, 'artifacts', appId, 'public', 'data', 'history'));
                        batch.set(histColRef, {
                            ...exitHeader,
                            item: item.name,
                            itemId: item.id,
                            qty: item.qty,
                            dateStr: dateStr,
                            timestamp: serverTimestamp()
                        });
                    });

                    await batch.commit();
                    setSelectedItems([]);
                    setExitHeader({ tech: '', monitor: '', description: '' });
                    setActiveTab('history');
                } catch (err) { console.error(err); }
            };

            const updateStock = async (docId, currentStock, mod) => {
                const { doc, updateDoc } = window.FirebaseSDK;
                try {
                    await updateDoc(doc(dbRef.current, 'artifacts', appId, 'public', 'data', 'inventory', docId), {
                        stock: Math.max(0, currentStock + mod)
                    });
                } catch (err) { console.error(err); }
            };

            const handleAddItem = async (e) => {
                e.preventDefault();
                const { collection, addDoc, serverTimestamp } = window.FirebaseSDK;
                try {
                    await addDoc(collection(dbRef.current, 'artifacts', appId, 'public', 'data', 'inventory'), {
                        ...newItem,
                        stock: Number(newItem.stock),
                        min: Number(newItem.min),
                        createdAt: serverTimestamp()
                    });
                    setNewItem({ id: '', name: '', stock: '', min: 5, unit: 'pza' });
                    setActiveTab('inventory');
                } catch (err) { console.error(err); }
            };

            const handleSaveEdit = async (e) => {
                e.preventDefault();
                const { doc, updateDoc } = window.FirebaseSDK;
                try {
                    await updateDoc(doc(dbRef.current, 'artifacts', appId, 'public', 'data', 'inventory', editingItem.docId), {
                        name: editingItem.name,
                        id: editingItem.id,
                        min: Number(editingItem.min),
                        unit: editingItem.unit
                    });
                    setEditingItem(null);
                } catch (err) { console.error(err); }
            };

            if (loading) return (
                <div className="h-screen flex flex-col items-center justify-center bg-white">
                    <div className="text-blue-600 animate-bounce mb-4"><EnergyLogo className="h-16 w-16" /></div>
                    <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Estableciendo conexión segura...</p>
                </div>
            );

            return (
                <div className="min-h-screen pb-20 no-print">
                    <header className="bg-white border-b border-slate-100 sticky top-0 z-50 px-6 py-4">
                        <div className="max-w-3xl mx-auto flex items-center justify-between">
                            <div className="flex items-center gap-4">
                                <div className="bg-blue-600 text-white p-2 rounded-xl shadow-lg"><EnergyLogo className="h-7 w-7" /></div>
                                <div>
                                    <div className="flex items-center gap-2">
                                        <span className="text-lg font-black text-slate-900 tracking-tighter uppercase">Airtek</span>
                                        <span className="text-[10px] font-black bg-blue-100 text-blue-600 px-1.5 py-0.5 rounded tracking-tighter uppercase">Energía</span>
                                    </div>
                                    <div className="flex items-center gap-1.5 mt-0.5">
                                        <span className={`w-1.5 h-1.5 rounded-full ${isCloud ? 'bg-emerald-500 pulse-online' : 'bg-red-500'}`}></span>
                                        <p className="text-[9px] font-bold text-slate-400 uppercase tracking-widest">
                                            {isCloud ? 'Servidor Activo' : 'Sin Conexión'}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </header>

                    <div className="max-w-3xl mx-auto p-4 space-y-6 mt-4">
                        <nav className="flex gap-1.5 bg-white p-1.5 rounded-3xl shadow-premium border border-slate-100 overflow-x-auto no-scrollbar">
                            {[
                                {id: 'inventory', label: 'Inventario'}, 
                                {id: 'exit', label: 'Despacho'}, 
                                {id: 'admin', label: 'Maestro'}, 
                                {id: 'history', label: 'Bitácora'}
                            ].map(t => (
                                <button key={t.id} onClick={() => {setActiveTab(t.id); setEditingItem(null);}} 
                                    className={`flex-1 min-w-[90px] py-3 rounded-2xl font-bold text-[10px] uppercase tracking-wider transition-all ${activeTab === t.id ? 'bg-blue-600 text-white shadow-lg' : 'text-slate-400 hover:text-blue-500 hover:bg-blue-50'}`}>
                                    {t.label}
                                </button>
                            ))}
                        </nav>

                        <main className="tab-content">
                            {editingItem && (
                                <div className="fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-[100] flex items-center justify-center p-4">
                                    <form onSubmit={handleSaveEdit} className="bg-white w-full max-w-md rounded-[2.5rem] shadow-2xl p-8 space-y-4">
                                        <div className="text-center mb-6">
                                            <h3 className="text-sm font-black uppercase text-slate-800">Editar Artículo</h3>
                                        </div>
                                        <div className="space-y-1">
                                            <label className="text-[9px] font-black text-slate-400 uppercase ml-4">Nombre</label>
                                            <input required className="w-full p-4 bg-slate-50 rounded-2xl text-[11px] font-bold border-2 border-transparent focus:border-blue-400 outline-none uppercase" value={editingItem.name} onChange={e=>setEditingItem({...editingItem, name: e.target.value})} />
                                        </div>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div className="space-y-1">
                                                <label className="text-[9px] font-black text-slate-400 uppercase ml-4">Código</label>
                                                <input required className="w-full p-4 bg-slate-50 rounded-2xl text-[11px] font-bold border-2 border-transparent focus:border-blue-400 outline-none uppercase" value={editingItem.id} onChange={e=>setEditingItem({...editingItem, id: e.target.value.toUpperCase()})} />
                                            </div>
                                            <div className="space-y-1">
                                                <label className="text-[9px] font-black text-slate-400 uppercase ml-4">Min. Stock</label>
                                                <input required type="number" className="w-full p-4 bg-slate-50 rounded-2xl text-[11px] font-bold border-2 border-transparent focus:border-blue-400 outline-none" value={editingItem.min} onChange={e=>setEditingItem({...editingItem, min: e.target.value})} />
                                            </div>
                                        </div>
                                        <div className="flex gap-3 pt-4">
                                            <button type="button" onClick={()=>setEditingItem(null)} className="flex-1 py-4 rounded-2xl font-black uppercase text-[10px] text-slate-400">Cancelar</button>
                                            <button type="submit" className="flex-2 bg-blue-600 text-white px-8 py-4 rounded-2xl font-black uppercase text-[10px]">Actualizar</button>
                                        </div>
                                    </form>
                                </div>
                            )}

                            {activeTab === 'inventory' && (
                                <div className="space-y-3">
                                    <div className="flex justify-between items-center px-4">
                                        <h2 className="text-[10px] font-black uppercase text-slate-400 tracking-widest">Existencias Actuales</h2>
                                        <button onClick={exportInventoryPDF} className="bg-slate-900 text-white px-4 py-2 rounded-xl text-[9px] font-black uppercase tracking-widest flex items-center gap-2">
                                            <svg className="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm5 2l4 4H11V4z"/></svg>
                                            Exportar PDF
                                        </button>
                                    </div>
                                    <div className="grid grid-cols-1 gap-3">
                                        {inventory.map(i => (
                                            <div key={i.docId} className="bg-white p-5 rounded-[2rem] flex flex-col sm:flex-row justify-between items-center shadow-sm border border-slate-100">
                                                <div className="flex items-center gap-4 w-full sm:w-auto">
                                                    <button onClick={() => setEditingItem(i)} className="p-3 bg-slate-50 text-slate-400 hover:text-blue-600 rounded-xl">
                                                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                                                    </button>
                                                    <div className="flex flex-col text-left">
                                                        <span className="font-extrabold text-[13px] uppercase tracking-tight text-slate-800">{i.name}</span>
                                                        <span className="text-[9px] text-slate-400 font-mono font-bold">{i.id}</span>
                                                    </div>
                                                </div>
                                                <div className="flex items-center gap-4 bg-slate-50 p-1.5 rounded-2xl">
                                                    <button onClick={() => updateStock(i.docId, i.stock, -1)} className="w-9 h-9 flex items-center justify-center bg-white rounded-xl font-bold text-slate-400">-</button>
                                                    <div className="px-4 text-center min-w-[70px]">
                                                        <div className={`font-black text-lg ${i.stock <= i.min ? 'text-red-500' : 'text-slate-900'}`}>{i.stock}</div>
                                                        <div className="text-[8px] text-slate-300 font-extrabold uppercase">{i.unit}</div>
                                                    </div>
                                                    <button onClick={() => updateStock(i.docId, i.stock, 1)} className="w-9 h-9 flex items-center justify-center bg-white rounded-xl font-bold text-slate-400">+</button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {activeTab === 'exit' && (
                                <div className="space-y-6">
                                    <form onSubmit={handleBulkExit} className="bg-white p-8 rounded-[2.5rem] shadow-premium border border-slate-100 space-y-6">
                                        <div className="text-center">
                                            <h3 className="text-sm font-black uppercase text-slate-800">Despacho de Materiales</h3>
                                        </div>

                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div className="space-y-1">
                                                <label className="text-[9px] font-black text-slate-400 uppercase ml-4">Beneficiario</label>
                                                <input required className="w-full p-4 bg-slate-50 rounded-2xl text-[11px] font-bold border-2 border-transparent focus:border-blue-400 outline-none uppercase" value={exitHeader.tech} onChange={e=>setExitHeader({...exitHeader, tech: e.target.value})} placeholder="TÉCNICO / PERSONA" />
                                            </div>
                                            <div className="space-y-1">
                                                <label className="text-[9px] font-black text-blue-600 uppercase ml-4">Monitor de Almacén</label>
                                                <select 
                                                    required 
                                                    className="w-full p-4 bg-slate-50 rounded-2xl text-[11px] font-bold border-2 border-transparent focus:border-blue-400 outline-none uppercase appearance-none"
                                                    value={exitHeader.monitor} 
                                                    onChange={e=>setExitHeader({...exitHeader, monitor: e.target.value})}
                                                >
                                                    <option value="">SELECCIONAR RESPONSABLE</option>
                                                    {monitoresAlmacen.map(m => <option key={m} value={m}>{m}</option>)}
                                                </select>
                                            </div>
                                        </div>

                                        <div className="space-y-1 relative">
                                            <label className="text-[9px] font-black text-slate-400 uppercase ml-4">Escribe nombre o código para buscar</label>
                                            <div className="relative">
                                                <input 
                                                    className="w-full p-4 bg-slate-50 rounded-2xl text-[11px] font-bold border-2 border-transparent focus:border-blue-400 outline-none uppercase"
                                                    value={currentSearch}
                                                    onFocus={() => setShowSearchList(true)}
                                                    onChange={e => {setCurrentSearch(e.target.value); setShowSearchList(true);}}
                                                    placeholder="BUSCAR ARTÍCULO..."
                                                />
                                                {showSearchList && filteredInventory.length > 0 && (
                                                    <div className="absolute top-full left-0 right-0 mt-2 bg-white rounded-2xl shadow-2xl border border-slate-100 z-50">
                                                        {filteredInventory.map(i => (
                                                            <div 
                                                                key={i.id} 
                                                                onClick={() => addItemToExitList(i)}
                                                                className="p-4 hover:bg-blue-50 cursor-pointer flex justify-between items-center border-b last:border-0"
                                                            >
                                                                <div>
                                                                    <div className="text-[11px] font-black text-slate-800 uppercase">{i.name}</div>
                                                                    <div className="text-[9px] text-slate-400 font-mono font-bold uppercase">{i.id}</div>
                                                                </div>
                                                                <div className="text-right">
                                                                    <div className="text-[10px] font-black text-blue-600 uppercase">Stock: {i.stock}</div>
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                )}
                                            </div>
                                        </div>

                                        <div className="space-y-4">
                                            <h4 className="text-[9px] font-black uppercase text-slate-400 ml-4">Materiales en Lista</h4>
                                            {selectedItems.length === 0 ? (
                                                <div className="bg-slate-50 p-6 rounded-[2rem] border-2 border-dashed border-slate-200 text-center">
                                                    <p className="text-[9px] font-bold text-slate-300 uppercase tracking-widest">Selecciona artículos para retirar</p>
                                                </div>
                                            ) : (
                                                <div className="space-y-2">
                                                    {selectedItems.map(item => (
                                                        <div key={item.id} className="bg-slate-50 p-4 rounded-2xl flex items-center justify-between gap-4">
                                                            <div className="flex-1">
                                                                <div className="text-[11px] font-black text-slate-800 uppercase truncate">{item.name}</div>
                                                                <div className="text-[8px] font-bold text-slate-400 uppercase">Disponible: {item.stock}</div>
                                                            </div>
                                                            <div className="flex items-center gap-3">
                                                                <input 
                                                                    type="number" 
                                                                    className="w-16 p-2 bg-white rounded-xl text-[11px] font-black text-center"
                                                                    value={item.qty}
                                                                    onChange={e => updateSelectedQty(item.id, e.target.value)}
                                                                    min="1"
                                                                    max={item.stock}
                                                                />
                                                                <button type="button" onClick={() => removeSelected(item.id)} className="p-2 text-slate-300 hover:text-red-500">
                                                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M6 18L18 6M6 6l12 12"></path></svg>
                                                                </button>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>

                                        <div className="space-y-1">
                                            <label className="text-[9px] font-black text-slate-400 uppercase ml-4">Motivo / Nodo</label>
                                            <input required className="w-full p-4 bg-slate-50 rounded-2xl text-[11px] font-bold border-2 border-transparent focus:border-blue-400 outline-none uppercase" value={exitHeader.description} onChange={e=>setExitHeader({...exitHeader, description: e.target.value})} placeholder="OBSERVACIONES" />
                                        </div>

                                        <button disabled={selectedItems.length === 0} className="w-full bg-blue-600 disabled:bg-slate-200 text-white p-5 rounded-3xl font-black uppercase text-[11px] shadow-xl">
                                            Confirmar Entrega de Material
                                        </button>
                                    </form>
                                </div>
                            )}

                            {activeTab === 'admin' && (
                                <form onSubmit={handleAddItem} className="bg-white p-8 rounded-[2.5rem] shadow-premium border border-slate-100 space-y-5">
                                    <div className="text-center mb-4">
                                        <h3 className="text-sm font-black uppercase text-slate-800">Alta de Artículo</h3>
                                    </div>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div className="space-y-1">
                                            <label className="text-[9px] font-black text-slate-400 uppercase ml-4">Código</label>
                                            <input required placeholder="ID-001" className="w-full p-4 bg-slate-50 rounded-2xl text-[11px] font-bold border-2 border-transparent focus:border-blue-400 outline-none uppercase" value={newItem.id} onChange={e=>setNewItem({...newItem, id: e.target.value.toUpperCase()})} />
                                        </div>
                                        <div className="space-y-1">
                                            <label className="text-[9px] font-black text-slate-400 uppercase ml-4">Nombre</label>
                                            <input required placeholder="DESC. ARTÍCULO" className="w-full p-4 bg-slate-50 rounded-2xl text-[11px] font-bold border-2 border-transparent focus:border-blue-400 outline-none uppercase" value={newItem.name} onChange={e=>setNewItem({...newItem, name: e.target.value})} />
                                        </div>
                                        <div className="space-y-1">
                                            <label className="text-[9px] font-black text-slate-400 uppercase ml-4">Stock Inicial</label>
                                            <input required type="number" className="w-full p-4 bg-slate-50 rounded-2xl text-[11px] font-bold border-2 border-transparent focus:border-blue-400 outline-none" value={newItem.stock} onChange={e=>setNewItem({...newItem, stock: e.target.value})} />
                                        </div>
                                        <div className="space-y-1">
                                            <label className="text-[9px] font-black text-slate-400 uppercase ml-4">Unidad</label>
                                            <input required placeholder="PZA / MTS" className="w-full p-4 bg-slate-50 rounded-2xl text-[11px] font-bold border-2 border-transparent focus:border-blue-400 outline-none uppercase text-center" value={newItem.unit} onChange={e=>setNewItem({...newItem, unit: e.target.value})} />
                                        </div>
                                    </div>
                                    <button className="w-full bg-slate-900 text-white p-5 rounded-3xl font-black uppercase text-[11px]">Guardar en Inventario</button>
                                </form>
                            )}

                            {activeTab === 'history' && (
                                <div className="space-y-3">
                                    <div className="flex justify-between items-center px-4">
                                        <h2 className="text-[10px] font-black uppercase text-slate-400 tracking-widest">Movimientos Recientes</h2>
                                        <button onClick={exportHistoryPDF} className="bg-slate-900 text-white px-4 py-2 rounded-xl text-[9px] font-black uppercase tracking-widest flex items-center gap-2">
                                            <svg className="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm5 2l4 4H11V4z"/></svg>
                                            Exportar PDF
                                        </button>
                                    </div>
                                    {history.map(h => (
                                        <div key={h.id} className="bg-white p-5 rounded-[2.2rem] flex flex-col sm:flex-row justify-between items-center shadow-sm border border-l-4 border-l-blue-500 gap-3">
                                            <div className="flex flex-col text-center sm:text-left">
                                                <div className="font-extrabold text-[12px] uppercase text-slate-800">{h.item}</div>
                                                <div className="text-[9px] font-bold text-slate-500 mt-1 uppercase">
                                                    Para: <span className="text-slate-800 font-black">{h.tech}</span>
                                                    <span className="mx-2 text-slate-200">|</span>
                                                    Por: <span className="text-blue-600 font-black">{h.monitor || '---'}</span>
                                                </div>
                                            </div>
                                            <div className="text-center sm:text-right shrink-0">
                                                <div className="text-red-500 font-black text-sm italic">-{h.qty}</div>
                                                <div className="text-[8px] text-slate-300 font-bold uppercase mt-1.5">{h.dateStr}</div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </main>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
